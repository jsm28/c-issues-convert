<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0321: Wide character code values for members of the basic character set</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0321: Wide character code values for members of the basic character set</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: Austin Group, Nick Stoughton (US)<br />
Date: 2005-04-26<br />
Reference document: <a href="issue0279.html">DR_279</a>, <a href="http://www.opengroup.org/austin/aardvark/latest/xbdbug2.txt">Austin Group Aardvark comment XBD ERN 53</a><br />
Submitted against: C99<br />
Status: Fixed<br />
Fixed in: C99 TC3<br />
Cross-references: <a href="issue0279.html">0279</a>, <a href="issue0333.html">0333</a><br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/summary-c99.htm">summary-c99.htm</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_321.htm">dr_321.htm</a></p>
<h3>Summary</h3>
<p>Originally, Standard C required <code>('x' == L'x')</code> to hold true when <code>x</code> is a
member of the basic character set. This restricted the implementation's choice
of <code>wchar_t</code> encoding, and the changes made in response to DR 279 removed this
restriction (published as change #58, on page 11 of TC2). However, there is a
vast body of existing application code that relies on this formerly normative
requirement for portability.</p>
<p>DR 279 suggested methods to relax the restriction that would make it easier for
applications to continue to rely on the relationship between basic characters
and their wide character equivalents. The POSIX community strongly urges WG14 to
reconsider the change introduced in ISO/IEC 9899:1999 Technical Corrigendum 2 in
response to DR 279.</p>
<h3>Details</h3>
<p>C99 7.17 paragraph 2 specified (before TC2) in part:</p>
<blockquote>
<p>"...</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">   </span><span style="color: #B00040">wchar_t</span>
</pre></div>

<p>which is an integer type whose range of values can represent distinct codes for
all members of the largest extended character set specified among the supported
locales; the null character shall have the code value zero and each member of
the basic character set shall have a code value equal to its value when used as
the lone character in an integer character constant."</p>
</blockquote>
<p>TC2 altered this text, removing the phrase:</p>
<blockquote>
<p>" and each member of the basic character set shall have a code value equal to
its value when used as the lone character in an integer character constant"</p>
</blockquote>
<p>In the committee discussion for TC2, an alternative approach was proposed:</p>
<blockquote>
<p>"...</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">   </span><span style="color: #B00040">wchar_t</span>
</pre></div>

<p>which is an integer type whose range of values can represent distinct codes for
all members of the largest extended character set specified among the supported
locales; the null character shall have the code value zero. Each member of the
basic character set shall have a code value equal to its value when used as the
lone character in an integer character constant if an implementation does not
define <code>__STDC_BTOWC_NEQ_WCTOB__</code>."</p>
</blockquote>
<p>The POSIX community, as represented by the Austin Group, would have preferred
this solution. Without any method to determine if the restriction applies or
not, all applications would be required to make changes that may have
performance and efficiency impacts in order to maintain portability. The ISO/IEC
9945:2004 POSIX standard contains words derived from the ISO/IEC 9899:1999
standard:</p>
<blockquote>
<p><strong>wchar_t</strong></p>
<p>Integer type whose range of values can represent distinct wide-character codes
for all members of the largest character set specified among the locales
supported by the compilation environment: the null character has the code value
0 and each member of the portable character set has a code value equal to its
value when used as the lone character in an integer character constant.</p>
</blockquote>
<p>In order to align with TC2, the Austin Group is proposing to change this to:</p>
<blockquote>
<p><strong>wchar_t</strong></p>
<p>Integer type whose range of values can represent distinct wide-character codes
for all members of the largest character set specified among the locales
supported by the compilation environment: the null character has the code value
0 and each member of the portable character set has a code value equal to its
value when used as the lone character in an integer character constant if an
implementation does not define <code>__POSIX_BTOWC_NEQ_WCTOB__</code>."</p>
</blockquote>
<p>However, the Austin Group also feels that such a change would be beneficial to
all C language users, and not just to the POSIX community, and therefore
respectfully suggests that if a future revision or technical corrigendum to
ISO/IEC 9899 were to be published, a similar change (using
<code>__STDC_BTOWC_NEQ_WCTOB__</code> as the macro name) would help application developers
understand when and where the restriction applies.</p>
<h3>Suggested Technical Corrigendum</h3>
<p>Suggestion 1 from DR279:</p>
<p>This change allows an implementation to deviate from the last part of 7.17
paragraph 2 if the macro <code>__STDC_BTOWC_NEQ_WCTOB__</code> is predefined. This would
not affect ASCII based systems, but would provide leeway for EBCDIC systems to
process Unicode using C.</p>
<p>Change the last part of 7.17 paragraph 2 as follows:</p>
<blockquote>
<p>"...</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">   </span><span style="color: #B00040">wchar_t</span>
</pre></div>

<p>which is an integer type whose range of values can represent distinct codes for
all members of the largest extended character set specified among the supported
locales; the null character shall have the code value zero. Each member of the
basic character set shall have a code value equal to its value when used as the
lone character in an integer character constant if an implementation does not
define <code>__STDC_BTOWC_NEQ_WCTOB__</code>."</p>
</blockquote>
<p>A program that requires the wchar_t restriction can check for the macro and
cause the translator to put out a diagnostic if the implementation does not
support the restriction. This at least would help diagnose porting problems.</p>
<hr />
<p>Comment from WG14 on 2006-04-04:</p>
<h3>Technical Corrigendum</h3>
<p>Change the last part of 7.17 paragraph 2 as follows:</p>
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">   </span><span style="color: #B00040">wchar_t</span>
</pre></div>

<p>which is an integer type whose range of values can represent distinct codes for
all members of the largest extended character set specified among the supported
locales; the null character shall have the code value zero. Each member of the
basic character set shall have a code value equal to its value when used as the
lone character in an integer character constant if an implementation does not
define <code>__STDC_MB_MIGHT_NEQ_WC__</code>.</p>
</blockquote>

</body>
</html>
