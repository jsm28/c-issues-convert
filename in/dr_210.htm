<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<html>
  <head>
    <meta name="generator" content=
    "HTML Tidy for Windows (vers 1st August 2002), see www.w3.org">

    <title>Defect Report #210</title>
  </head>

  <body>
    <h2 align="center">Defect Report #210</h2>
    <a href="dr_209.htm">Previous Defect Report</a> &lt; - &gt; <a
    href="dr_211.htm">Next Defect Report</a> 

    <p><br>
     <b>Submitter:</b> Fred Tydeman (US)<br>
     <b>Submission Date:</b> 1999-10-20<br>
     <b>Source:</b> WG 14<br>
     <b>Reference Document:</b> N/A<br>
     <b>Version:</b> 1.2<br>
     <b>Date:</b> 2001-01-22 03:49:35<br>
     <b>Subject:</b> <tt><b>fprintf %a</b></tt> and
    <tt><b>%A</b></tt> conversions recommended practice</p>

    <p><b>Summary</b><br>
     What should <tt><b>fprintf</b></tt> do when it is printing a
    floating-point number using <tt><b>%a</b></tt> and
    <tt><b>%A</b></tt> conversions and it is exactly representable
    in the given precision? That is, what is the result of:
    <tt><b>fprintf("%a", 1.0);</b></tt>? The current wording
    appears to say that it be converted into either
    <tt><b>0x1.0p0+DBL_EPSILON</b></tt> or
    <tt><b>0x1.0p0-DBL_EPSILON/FLT_RADIX</b></tt>, instead of the
    correct value <tt><b>0x1.0p0</b></tt> (this appears to be an
    oversight that forgot about exactly representable values).</p>

    <p>What should the <tt><b>strtod</b></tt> family of functions
    do when converting a hexadecimal form of input and the result
    is exactly representable? That is, what is the result of:
    <tt><b>strtod("0x1.0p0", (char **)NULL);</b></tt>? The current
    wording appears to say that it be converted into either
    <tt><b>1.0+DBL_EPSILON</b></tt> or
    <tt><b>1.0-DBL_EPSILON/FLT_RADIX</b></tt>, instead of the
    correct value <tt><b>1.0</b></tt> (this appears to be an
    oversight that forgot about exactly representable values).</p>
    <hr>

    <p><b>Technical Corrigendum</b><br>
     7.19.6.1 The <tt><b>fprintf</b></tt> function:</p>

    <p>Page 279, Paragraph 12 should be changed from:</p>

    <blockquote>
      If <tt><b>FLT_RADIX</b></tt> is not a power of 2, the result
      should be one of the two adjacent numbers in hexadecimal
      floating style with the given precision, with the extra
      stipulation that the error should have a correct sign for the
      current rounding direction.
    </blockquote>
    to: 

    <blockquote>
      For <tt><b>a</b></tt> and <tt><b>A</b></tt> conversions, if
      <tt><b>FLT_RADIX</b></tt> is not a power of 2 and the result
      is not exactly representable in the given precision, the
      result should be one of the two adjacent numbers in
      hexadecimal floating style with the given precision, with the
      extra stipulation that the error should have a correct sign
      for the current rounding direction.
    </blockquote>

    <p>7.20.1.3 The <tt><b>strtod</b></tt> ... functions:</p>

    <p>Page 308, paragraph 8 should be changed from:</p>

    <blockquote>
      If the subject sequence has the hexadecimal form and
      <tt><b>FLT_RADIX</b></tt> is not a power of 2, the result
      should be one of the two numbers in the appropriate internal
      format that are adjacent to the hexadecimal floating source
      value, with the extra stipulation that the error should have
      a correct sign for the current rounding direction.
    </blockquote>
    to: 

    <blockquote>
      If the subject sequence has the hexadecimal form,
      <tt><b>FLT_RADIX</b></tt> is not a power of 2 and the result
      is not exactly representable, the result should be one of the
      two numbers in the appropriate internal format that are
      adjacent to the hexadecimal floating source value, with the
      extra stipulation that the error should have a correct sign
      for the current rounding direction.
    </blockquote>
    <br>
     7.24.2.1 The <tt><b>fwprintf</b></tt> function: 

    <p>Page 354, Paragraph 12 should be changed from:</p>

    <blockquote>
      If <tt><b>FLT_RADIX</b></tt> is not a power of 2, the result
      should be one of the two adjacent numbers in hexadecimal
      floating style with the given precision, with the extra
      stipulation that the error should have a correct sign for the
      current rounding direction.
    </blockquote>
    to: 

    <blockquote>
      For <tt><b>a</b></tt> and <tt><b>A</b></tt> conversions, if
      <tt><b>FLT_RADIX</b></tt> is not a power of 2 and the result
      is not exactly representable in the given precision, the
      result should be one of the two adjacent numbers in
      hexadecimal floating style with the given precision, with the
      extra stipulation that the error should have a correct sign
      for the current rounding direction.
    </blockquote>

    <p>7.24.4.1.1 The <tt><b>wcstod</b></tt> ... functions:</p>

    <p>Page 372, paragraph 8 should be changed from:</p>

    <blockquote>
      If the subject sequence has the hexadecimal form and
      <tt><b>FLT_RADIX</b></tt> is not a power of 2, the result
      should be one of the two numbers in the appropriate internal
      format that are adjacent to the hexadecimal floating source
      value, with the extra stipulation that the error should have
      a correct sign for the current rounding direction.
    </blockquote>
    to: 

    <blockquote>
      If the subject sequence has the hexadecimal form,
      <tt><b>FLT_RADIX</b></tt> is not a power of 2 and the result
      is not exactly representable, the result should be one of the
      two numbers in the appropriate internal format that are
      adjacent to the hexadecimal floating source value, with the
      extra stipulation that the error should have a correct sign
      for the current rounding direction.
    </blockquote>

    <p><br>
     <a href="dr_209.htm">Previous Defect Report</a> &lt; - &gt; <a
    href="dr_211.htm">Next Defect Report</a></p>
  </body>
</html>

