<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0 plus SQ/ICADD Tables//EN" "html.dtd"
>
<HTML><HEAD><TITLE>Defect Report #144</TITLE></HEAD>
<BODY><H2>Defect Report #144</H2> 
<B>Submission Date</B>: 23 Feb 95
<BR>
<B>Submittor</B>: BSI
<BR>
<B>Source</B>: Clive D.W. Feather
<BR>
<B>Question</B>
<BR>
<I>Submitted to BSI by Clive D.W. Feather clive@sco.com.</I>
<BR>
<I>In this Defect Report, identifiers lexically identical to those
declared in standard headers refer to the identifiers declared in  those
standard headers, whether or not the header is explicitly mentioned.</I>
<BR>
<I>This Defect Report has been prepared with considerable help from 
Mark Brader, Jutta Degener, Ronald Guilmette, and a person whose
employment  conditions require anonymity. However, except where stated,
opinions  expressed or implied should not be assumed to be those of any
person  other than myself.</I>
<BR> Defect Report UK 028: Preprocessing of preprocessing directives
<BR> Can the white space preceeding the initial <TT><B>#</B></TT> of
a preprocessing  directive be derived from macro expansion? Consider the
following  code extract:
<BR>
<TT><B>#define EMPTY<BR> # EMPTY include &lt;file.h>  /*</B><I> Line A </I><B>*/<BR>
EMPTY # include &lt;file.h>  /*</B><I> Line B </I><B>*/
<BR></B></TT> Line A is clearly forbidden by subclause 6.8:
<BLOCKQUOTE> The preprocessing tokens within a preprocessing directive are  not
subject to macro expansion unless otherwise stated.
</BLOCKQUOTE> However, this text does not appear to forbid line B. Nor does
subclause  6.8.3.4:
<BLOCKQUOTE> The resulting completely macro-replaced preprocessing token 
sequence is not processed as a preprocessing directive even if it 
resembles one. If that subclause applies only to the expansion of 
<TT><B>EMPTY</B></TT>, it is not relevant. If it applies to both the
expansion  and the following preprocessing token sequence, then no
subsequent  preprocessing directive could ever be processed.
</BLOCKQUOTE> Is line B strictly conforming, or does it violate a constraint
(and  if so, which), or does it cause undefined behavior?
<BR>
<B>Suggested Technical Corrigendum:</B>
<BR> In subclause 6.8 Description, change:
<BLOCKQUOTE> A preprocessing directive consists of a sequence of preprocessing 
tokens that begins with a # preprocessing token that is either ...
</BLOCKQUOTE> to:
<BLOCKQUOTE> A preprocessing directive consists of a sequence of preprocessing 
tokens that begins with a # preprocessing token that (at the start  of
translation phase 4, before any preprocessing takes place) is either 
...
</BLOCKQUOTE> <B>Suggested Future Change</B>
<BR> The current C Standard has correct meaning, but the wording could 
be clearer. We suggest the following change for the revised C Standard:
<BLOCKQUOTE> A preprocessing directive consists of a directive consists of  a
sequence of preprocessing tokens that begins with a <TT><B>#</B></TT>
preprocessing  token that (at the start of translation phase 4) is
either ...
</BLOCKQUOTE>
<BR>
<A HREF="dr_143.html">Previous Defect Report</A> 
&lt; - &gt; 
<A HREF="dr_145.html"> Next Defect Report</A>
</BODY></HTML>
