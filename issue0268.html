<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0268: jumps into iteration statements</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0268: jumps into iteration statements</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: Clive D.W. Feather &lt;clive@demon.net&gt;, UK C Panel<br />
Date: 2001-09-07<br />
Submitted against: C99<br />
Status: Fixed<br />
Fixed in: C99 TC3<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/summary-c99.htm">summary-c99.htm</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_268.htm">dr_268.htm</a></p>
<h3>Problem</h3>
<p>Consider the code:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>x<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #666666">0</span>;
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">goto</span><span style="color: #bbbbbb"> </span>centre;
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">while</span><span style="color: #bbbbbb"> </span>(<span style="color: #666666">++</span>x<span style="color: #bbbbbb"> </span><span style="color: #666666">&lt;</span><span style="color: #bbbbbb"> </span><span style="color: #666666">10</span>)
<span style="color: #bbbbbb">    </span>{
<span style="color: #bbbbbb">        </span><span style="color: #3D7B7B; font-style: italic">// Some code centre:</span>
<span style="color: #bbbbbb">        </span><span style="color: #3D7B7B; font-style: italic">// More code }</span>
</pre></div>

<p>"Everyone knows" that, when the end of the block is reached, the loop test is
evaluated in the normal way. Nevertheless, I can find nothing in the Standard
that says so (it is implied by the example in 6.8.6.1#3, but that is all). Note
that in:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>x;
<span style="color: #bbbbbb">    </span><span style="color: #3D7B7B; font-style: italic">// ... if (condition) { x = -1; goto true_case; }</span>
<span style="color: #bbbbbb">    </span><span style="color: #3D7B7B; font-style: italic">// ... if (x &gt; 0)</span>
<span style="color: #bbbbbb">      </span><span style="color: #767600">true_case</span>:
<span style="color: #bbbbbb">        </span>do_something<span style="color: #bbbbbb"> </span>();
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">else</span>
<span style="color: #bbbbbb">        </span>do_something_else<span style="color: #bbbbbb"> </span>();
</pre></div>

<p>the <code>else</code> case is not executed after a jump to <code>true_case</code>, even though the
condition <code>x &gt; 0</code> is false. Therefore it is not possible to argue from analogy;
note also that this latter case is spelled out in the Standard. Since this
technique is well-known, it ought to be well-defined.</p>
<h3>Suggested Technical Corrigendum</h3>
<p>Add a new paragraph after 6.8.5#4:</p>
<blockquote>
<p>[#4a] If the loop body is reached by a jump from outside the iteration
statement, the behavior is as if the body were entered in the normal way. That
is, when the end of the body is reached the controlling expression is evaluated
(and, in the case of a <code>for</code> statement, <em>expr-3</em> is evaluated first) and the
body re-executed if it is not 0. Similarly, a <code>break</code> or <code>continue</code> statement
has the appropriate effect. However, the code jumped over - including the
controlling expressions in the case of a <code>while</code> or <code>for</code> statement - is not
evaluated when the jump happens.</p>
</blockquote>
<p>Possibly also add an example either as 6.8.5#6 or 6.8.6.1#5 (with appropriate
editorial changes):</p>
<blockquote>
<p>[#6] EXAMPLE: A jump into a <code>for</code> statement does not execute <em>clause-1</em> at all
or <em>expr-2</em> during the jump:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">  </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>i<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #666666">5</span>;
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">if</span><span style="color: #bbbbbb"> </span>(condition)<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">goto</span><span style="color: #bbbbbb"> </span>body;
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">for</span><span style="color: #bbbbbb"> </span>(i<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #666666">0</span>;<span style="color: #bbbbbb"> </span>i<span style="color: #bbbbbb"> </span><span style="color: #666666">&lt;</span><span style="color: #bbbbbb"> </span><span style="color: #666666">10</span>;<span style="color: #bbbbbb"> </span>i<span style="color: #666666">++</span>)
<span style="color: #bbbbbb">        </span>{
<span style="color: #bbbbbb">            </span><span style="color: #008000; font-weight: bold">if</span><span style="color: #bbbbbb"> </span>(i<span style="color: #bbbbbb"> </span><span style="color: #666666">&gt;</span><span style="color: #bbbbbb"> </span><span style="color: #666666">2</span>)<span style="color: #bbbbbb"> </span>i<span style="color: #666666">++</span>;
<span style="color: #bbbbbb">        </span><span style="color: #767600">body</span>:
<span style="color: #bbbbbb">            </span>printf<span style="color: #bbbbbb"> </span>(<span style="color: #BA2121">&quot; %d&quot;</span>,<span style="color: #bbbbbb"> </span>i);
<span style="color: #bbbbbb">        </span>}
<span style="color: #bbbbbb">        </span>printf<span style="color: #bbbbbb"> </span>(<span style="color: #BA2121">&quot;</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>);
</pre></div>

<p>If <code>condition</code> is true, this prints:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">  </span><span style="color: #666666">5</span><span style="color: #bbbbbb"> </span><span style="color: #666666">7</span><span style="color: #bbbbbb"> </span><span style="color: #666666">9</span>
</pre></div>

<p>while if it is false it prints:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">  </span><span style="color: #666666">0</span><span style="color: #bbbbbb"> </span><span style="color: #666666">1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">2</span><span style="color: #bbbbbb"> </span><span style="color: #666666">4</span><span style="color: #bbbbbb"> </span><span style="color: #666666">6</span><span style="color: #bbbbbb"> </span><span style="color: #666666">8</span><span style="color: #bbbbbb"> </span><span style="color: #666666">10</span>
</pre></div>

</blockquote>
<hr />
<p>Comment from WG14 on 2006-03-29:</p>
<h3>Committee Discussion</h3>
<p>While we agree that this may be a defect, we are not happy with the proposed
words, and processing this defect is postponed pending improved wording.
Specifically, "as if the body were entered in the normal way" raises a few new
questions.</p>
<h3>Technical Corrigendum</h3>
<p>Append to 6.8.5#4:</p>
<blockquote>
<p>The repetition occurs regardless of whether the loop body is entered from the
iteration statement or by a jump.<sup>*</sup></p>
<p><sup>*</sup> Code jumped over is not executed. In particular, the controlling
expression of a <code>for</code> or <code>while</code> statement is not evaluated before entering the
loop body, nor is <em>clause-1</em> of a <code>for</code> statement.</p>
</blockquote>

</body>
</html>
