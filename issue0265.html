<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0265: preprocessor arithmetic</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0265: preprocessor arithmetic</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: Clive D.W. Feather &lt;clive@demon.net&gt;, UK C Panel<br />
Date: 2001-09-07<br />
Submitted against: C99<br />
Status: Fixed<br />
Fixed in: C99 TC2<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/summary-c99.htm">summary-c99.htm</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_265.htm">dr_265.htm</a></p>
<h3>Problem</h3>
<p>Assume that both compile-time and run-time arithmetic have 2's complement, no
trap representations, 8/16/32/48/64 bit integer types. Consider the code:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">  </span><span style="color: #9C6500">#if -0xFFFFFFFF &lt; 0</span>
</pre></div>

<p>Is this expression true or false ? 6.10.1#3 reads, in part:</p>
<blockquote>
<p>and then each preprocessing token is converted into a token. The resulting
tokens compose the controlling constant expression which is evaluated according
to the rules of 6.6, except that all signed integer types and all unsigned
integer types act as if they have the same representation as, respectively, the
types <code>intmax_t</code> and <code>uintmax_t</code> defined in the header <code>&lt;stdint.h&gt;</code>.</p>
</blockquote>
<p>Does the "except" wording apply to the conversion to a token, or only to the
evaluation of the expression ? If the former, then 0xFFFFFFFF can be represented
in an <code>int</code> (<code>intmax_t</code>), it has a signed type, and the expression is true. If
the latter, 0xFFFFFFFF cannot be represented in an <code>int</code> but can be represented
in an <code>unsigned int</code>, so it has unsigned type and the expression is false.</p>
<p>I believe that the former was intended, with the preprocessor only having to
consider one pair of integer types.</p>
<h3>Suggested Technical Corrigendum</h3>
<p>Change the cited text to:</p>
<blockquote>
<p>and then each preprocessing token is converted into a token. The resulting
tokens compose the controlling constant expression which is evaluated according
to the rules of 6.6. <strong>For the purposes of the conversion and evaluation</strong> all
signed integer types and all unsigned integer types act as if they have the same
representation as, respectively, the types <code>intmax_t</code> and <code>uintmax_t</code> defined in
the header <code>&lt;stdint.h&gt;</code>.</p>
</blockquote>
<p>(bold type shows the changed words)</p>
<p>Add a footnote reference to the end of this text, and add the footnote:</p>
<blockquote>
<p>140a Thus on an implementation where <code>INT_MAX</code> is 0x7FFF and <code>UINT_MAX</code> is
0xFFFF, the constant 0x8000 is signed within a <code>#if</code> expression even though it
is unsigned in translation phase 7.</p>
</blockquote>
<hr />
<p>Comment from WG14 on 2002-05-15:</p>
<h3>Technical Corrigendum</h3>
<p>Change 6.10.1#3 to read:</p>
<blockquote>
<p>...</p>
<p>and then each preprocessing token is converted into a token. The resulting
tokens compose the controlling constant expression which is evaluated according
to the rules of 6.6. For the purposes of this token conversion and evaluation
all signed integer types and all unsigned integer types act as if they have the
same representation as, respectively, the types <code>intmax_t</code> and <code>uintmax_t</code>
defined in the header <code>&lt;stdint.h&gt;</code>.</p>
</blockquote>
<p>Add a footnote to the end of 6.10.1#3 to read:</p>
<blockquote>
<p>Thus on an implementation where <code>INT_MAX</code> is 0x7FFF and <code>UINT_MAX</code> is 0xFFFF,
the constant 0x8000 is signed and positive within a <code>#if</code> expression even though
it is unsigned in translation phase 7.</p>
</blockquote>

</body>
</html>
