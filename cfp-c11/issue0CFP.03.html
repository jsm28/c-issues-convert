<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0CFP.03: Part 1: feature macros and header file inclusions</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0CFP.03: Part 1: feature macros and header file inclusions</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: WG14, Jim Thomas et al.<br />
Date: 2016-03-19<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2029.pdf">N2029</a><br />
Submitted against: Floating-point TS 18661 (C11 version, 2014-2016)<br />
Status: Fixed<br />
Fixed in: C23<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2397.htm">n2397.htm</a></p>
<h3>Summary</h3>
<p>ISO/IEC TS 18661-1 subclause 5.3 specifies interfaces that are defined or
declared “only if <strong>__STDC_WANT_IEC_60559_BFP_EXT__</strong> is defined as a
macro at the point in the source file where the header for the interface is
first included.” C 7.12#1 says <strong>&lt;tgmath.h&gt;</strong> includes <strong>&lt;math.h&gt;</strong> and
<strong>&lt;complex.h&gt;</strong>.</p>
<p>So for</p>
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #9C6500">#include</span><span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">&lt;math.h&gt;</span>
<span style="color: #9C6500">#define __STDC_WANT_IEC_60559_BFP_EXT__</span>
<span style="color: #9C6500">#include</span><span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">&lt;tgmath.h&gt;</span>
<span style="color: #B00040">float</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF">f</span>(<span style="color: #B00040">float</span><span style="color: #bbbbbb"> </span>x)<span style="color: #bbbbbb"> </span>{<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>nextup(x);<span style="color: #bbbbbb"> </span>}
</pre></div>

</blockquote>
<p>the <strong>nextup</strong> functions in <strong>&lt;math.h&gt;</strong> are not declared and the <strong>nextup</strong>
macro in <strong>&lt;tgmath.h&gt;</strong> is defined. Since x has type float, the function
determined by the <strong>nextup</strong> macro in <strong>&lt;tgmath.h&gt;</strong> is <strong>nextupf</strong>. But is
this function available to be called? Another example. For</p>
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #9C6500">#include</span><span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">&lt;limits.h&gt;</span>
<span style="color: #9C6500">#define __STDC_WANT_IEC_60559_BFP_EXT__</span>
<span style="color: #9C6500">#include</span><span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">&lt;math.h&gt;</span>
...
</pre></div>

</blockquote>
<p>the <strong>fromfp</strong> functions in <strong>&lt;math.h&gt;</strong> are declared, but the <strong>WIDTH</strong>
macros in <strong>&lt;limits.h&gt;</strong>, which are needed for portable use of the <strong>fromfp</strong>
functions, are not defined. In these examples, interfaces provided by one header
are related to interfaces that are not provided by another header, because of
the placement of the <strong>WANT</strong> macros. This leads to ambiguous cases (as in the
first example above) and incomplete feature sets. Later parts of the TS have
their own WANT macros, which compounds the problem. See also Joseph Myers’s
&lt;<a href="https://www.open-std.org/jtc1/sc22/wg14/13831">http://www.open-std.org/jtc1/sc22/wg14/13831</a>&gt;.</p>
<p>The suggested corrigendum below specifies that the same set of <strong>WANT</strong> macros
must be defined at the points in the code where the relevant headers are first
included. This results in fewer combinations of interfaces and provides one sets
of interfaces that is consistent and complete with respect to a given set of
WANT macros.</p>
<h3>Suggested Technical Corrigendum</h3>
<p>Page 5: At the end of 5.3, insert:</p>
<blockquote>
<p>After 7.1.2#4, insert:</p>
<blockquote>
<p>[4a] Some standard headers define or declare identifiers contingent on whether
certain macros whose names begin with <strong>_STDC_WANT_IEC_60559_</strong> and end
with <strong>_EXT_</strong> are defined (by the user) at the point in the code where the
header is first included. Within a preprocessing translation unit, the same set
of such macros shall be defined for the first inclusion of all such headers.</p>
</blockquote>
</blockquote>
<hr />
<p>Comment from WG14 on 2018-10-18:</p>
<p>Apr 2016 meeting</p>
<h3>Committee Discussion</h3>
<p>The committee agrees that this is a defect and accepts the Suggested Technical
Corrigendum</p>
<h3>Proposed Technical Corrigendum</h3>
<p>Page 5: At the end of 5.3, insert:</p>
<blockquote>
<p>After 7.1.2#4, insert:</p>
<blockquote>
<p>[4a] Some standard headers define or declare identifiers contingent on whether
certain macros whose names begin with <strong>_STDC_WANT_IEC_60559_</strong> and end
with <strong>_EXT_</strong> are defined (by the user) at the point in the code where the
header is first included. Within a preprocessing translation unit, the same set
of such macros shall be defined for the first inclusion of all such headers.</p>
</blockquote>
</blockquote>

</body>
</html>
