<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0240: lrint, llrint, lround, llround, and ilogb descriptions are not consistent for unrepresentable results</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0240: <code>lrint</code>, <code>llrint</code>, <code>lround</code>, <code>llround</code>, and <code>ilogb</code> descriptions are not consistent for unrepresentable results</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: Fred Tydeman (US)<br />
Date: 2001-02-25<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n943.txt">ISO/IEC WG14 N943</a><br />
Submitted against: C99<br />
Status: Fixed<br />
Fixed in: C99 TC2<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/summary-c99.htm">summary-c99.htm</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_240.htm">dr_240.htm</a></p>
<h3>Summary</h3>
<blockquote>
<p><code>lrint</code>, <code>llrint</code>, <code>lround</code>, <code>llround</code>, and <code>ilogb</code> need to have consistent and
explicit descriptions when results are too big to represent in an integer type.
Also, that case should be treated as a domain error.</p>
</blockquote>
<h3>Details</h3>
<blockquote>
<p>IEC 60559 requires that when a large floating-point value, an infinity, or a NaN
is converted to an integer, and the result cannot be represented as an integer
in the result's format, an invalid operation has occurred. This is currently
mostly reflected in C99's Annex F. This condition corresponds to C's domain
error.</p>
<p><code>ilogb</code> does not discuss (in either 7.12.6.5 or annex F) what should happen if
the expected result cannot be represented as an <strong>int</strong>. It should be treated as
a domain error (because it is an invalid operation to IEC 60559). The "correct"
result of <code>ilogb(0)</code> is -infinity (which cannot be represented as an <strong>int</strong>, so
should be treated as a domain error). <code>ilogb(NaN)</code> does not follow the normal
convention of NaN in implies NaN out, so this unusual case needs to be
discussed.</p>
<p><code>lrint</code> and <code>llrint</code> are inconsistent on how large arguments are treated between
7.12.9.5 (range error) and Annex F (domain error).</p>
<p><code>lround</code> and <code>llround</code> are inconsistent on how large arguments are treated
between 7.12.9.7 (range error) and Annex F (domain error).</p>
</blockquote>
<h3>Suggested Technical Corrigendum</h3>
<p>In 7.12.6.5 <code>ilogb</code>:</p>
<p>Change:</p>
<blockquote>
<p>A range error may occur if <code>x</code> is <code>0</code>.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>A domain error occurs if <code>x</code> is <code>0</code>, infinite, or <code>NaN</code>.</p>
</blockquote>
<p>Add:</p>
<blockquote>
<p>If the correct value is outside the range of the return type, the numeric result
is unspecified, and a domain error occurs.</p>
</blockquote>
<p>In 7.12.9.5 <code>lrint llrint</code>:</p>
<p>Change:</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified. A range error may occur if the magnitude of <code>x</code> is too large.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified, and a domain error occurs.</p>
</blockquote>
<p>In 7.12.9.7 <code>lround llround</code>:</p>
<p>Change:</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified. A range error may occur if the magnitude of <code>x</code> is too large.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified, and a domain error occurs.</p>
</blockquote>
<hr />
<p>Comment from WG14 on 2004-03-16:</p>
<h3>Technical Corrigendum</h3>
<p>In 7.12.6.5 <code>ilogb</code>:</p>
<p>Change:</p>
<blockquote>
<p>A range error may occur if <code>x</code> is <code>0</code>.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>A domain error or range error may occur if <code>x</code> is <code>0</code>, infinite, or <code>NaN</code>.</p>
</blockquote>
<p>Add:</p>
<blockquote>
<p>If the correct value is outside the range of the return type, the numeric result
is unspecified.</p>
</blockquote>
<p>In F.9.3.5 <code>ilogb</code>:</p>
<p>Change:</p>
<blockquote>
<p>No additional requirements.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>If the correct result is outside the range of the return type, the numeric
result is unspecified and the "invalid" floating-point exception is raised.</p>
</blockquote>
<p>In 7.12.9.5 <code>lrint</code> and <code>llrint</code>:</p>
<p>Change:</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified. A range error may occur if the magnitude of <code>x</code> is too large.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified, and a domain error or range error may occur.</p>
</blockquote>
<p>In 7.12.9.7 <code>lround</code> and <code>llround</code>:</p>
<p>Change:</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified. A range error may occur if the magnitude of <code>x</code> is too large.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>If the rounded value is outside the range of the return type, the numeric result
is unspecified, and a domain error or range error may occur.</p>
</blockquote>

</body>
</html>
