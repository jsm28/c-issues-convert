<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0497: &quot;white-space character&quot; defined in two places</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0497: "white-space character" defined in two places</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: WG14, Fred J. Tydeman<br />
Date: 2016-03-24<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2032.htm">N2032</a><br />
Submitted against: C11 / C17<br />
Status: Fixed<br />
Fixed in: C23<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2396.htm">n2396.htm</a></p>
<h3>Summary</h3>
<p>"white-space character" is defined differently in two places in the standard.</p>
<p>white-space character is defined in 6.4 as:</p>
<blockquote>
<p>space, horizontal tab, new-line, vertical tab, form-feed</p>
</blockquote>
<p>standard white-space character is defined in 7.4.1.10 for <strong>isspace()</strong> as:</p>
<blockquote>
<p>space, horizontal tab, new-line, vertical tab, form-feed, carriage return</p>
</blockquote>
<p>One place it matters is 7.21.6.2 fscanf().</p>
<p>7.21.6.2 fscanf() in paragraph 5 talks about white-space character(s) in the
directive. Since there is no reference to <strong>isspace</strong>, it must be referring to
6.4 (which I believe is wrong).</p>
<p>Paragraph 8, in the same section, talks about input white-space characters, but
refers to <strong>isspace</strong>.</p>
<p>In the following code, the \r (carriage return) is a directive:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #9C6500">#include</span><span style="color: #bbbbbb">  </span><span style="color: #3D7B7B; font-style: italic">&lt;stdio.h&gt;</span>
<span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF">main</span>(<span style="color: #B00040">void</span>){
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">static</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>rc,<span style="color: #bbbbbb"> </span>cnt1,<span style="color: #bbbbbb"> </span>cnt2,<span style="color: #bbbbbb"> </span>i;
<span style="color: #bbbbbb">  </span>rc<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>sscanf(<span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot; 123&quot;</span>,<span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot;</span><span style="color: #AA5D1F; font-weight: bold">\r</span><span style="color: #BA2121">%n%i%n&quot;</span>,<span style="color: #bbbbbb"> </span><span style="color: #666666">&amp;</span>cnt1,<span style="color: #bbbbbb"> </span><span style="color: #666666">&amp;</span>i,<span style="color: #bbbbbb"> </span><span style="color: #666666">&amp;</span>cnt2);
<span style="color: #bbbbbb">  </span>printf(<span style="color: #BA2121">&quot;rc=%i, cnt1=%i, i=%i, cnt2=%i</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>,<span style="color: #bbbbbb"> </span>rc,<span style="color: #bbbbbb"> </span>cnt1,<span style="color: #bbbbbb"> </span>i,<span style="color: #bbbbbb"> </span>cnt2);
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span><span style="color: #666666">0</span>;
}
</pre></div>

<p>Is the \r a white-space character or an ordinary multibyte character?</p>
<p>By 5.2.1#3, the \r is part of the basic execution character set, but is not
part of the basic source character set (as Doug Gwyn pointed out in message
14152).</p>
<p>By 6.4#3, the \r is not a white-space character.</p>
<p>By 7.21.6.2#3, #5 and #6, since the \r is not a white-space character, it is an
ordinary multibyte character. Therefore, since the \r does not match the
characters of the stream, cnt1, i, and cnt2 are not altered. However, this not
what most implementations do. They output: rc=1, cnt1=1, i=123, cnt2=4</p>
<p>I see a mismatch between what implementations are doing and what the standard
requires.</p>
<p>Another issue is "white space" in 7.21.6.2#15. It should be "white-space
characters". Section 6.4 defines "white space" as both comments and white-space
characters. So, the use of "white space" in 7.21.6.2#15 would cause /* comments
*/ to be matched. The same issue applies to 7.29.2.2#15, 7.29.4.1.2#4,
7.22.1.4#4.</p>
<p>Another issue is "white-space wide character" is not well defined (in
7.30.2.1.10) and is missing from the index. Does the "C" locale matter?</p>
<h3>Suggested Technical Corrigendum</h3>
<p>There are several ways this basic issue can be addressed.</p>
<ol>
<li>
<p>Add 'carriage return' to the definition of white-space in 6.4. However, this only makes 6.4 and <strong>isspace</strong> match for the "C" locale.</p>
</li>
<li>
<p>Add '(as specified by the <strong>isspace</strong> function)' to 'white-space characters' throughout clause 7 of the standard. Add '(as specified by the <strong>iswspace</strong> function)' to 'white-space wide characters' throughout clause 7.</p>
</li>
<li>
<p>Throughout clauses 5 and 6 (except for 5.1.1.2#7 which is execution), change 'white-space characters' to 'source white-space characters'. There might be an issue with 'non-white-space character' being changed to 'non-source-white-space character'.</p>
<p>In clause 7.1.1, add definitions of 'execution white-space character' and
'execution white-space wide character'. Change 'white-space character' to
'execution white-space character' throughout clause 7. Change 'white-space wide
character' to 'execution white-space wide character' throughout clause 7.</p>
<p>Throughout clause 7, remove '(as specified by the <strong>isspace</strong> function)' and
'(as specified by the <strong>iswspace</strong> function)'.</p>
</li>
<li>
<p>In (perhaps) 7.1.1, add something along the lines of:</p>
<blockquote>
<p>In this clause, references to "white-space character" refer to execution
white-space character as defined by <strong>isspace()</strong>. References to "white-space
wide character" refer to execution white-space wide character as defined by
<strong>iswspace()</strong>.</p>
</blockquote>
<p>Throughout clause 7, remove '(as specified by the <strong>isspace</strong> function)' and
'(as specified by the <strong>iswspace</strong> function)'.</p>
</li>
</ol>
<p>Some of the above changes also require corresponding changes to Annexes A and J.</p>
<p>Also do these changes:</p>
<ol>
<li>In 7.21.6.2#15, 7.29.2.2#15, 7.29.4.1.2#4, change "white space" to "white-space characters".</li>
<li>Give a better definition of "white-space wide character" in 7.30.2.1.10 with respect to "C" locale.</li>
<li>Add "white-space wide character" to the index.</li>
</ol>
<hr />
<p>Comment from WG14 on 2018-10-18:</p>
<p>Oct 2016 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The committee rejects options 1 and 3 and prefers options 2 and 4.</p>
</blockquote>
<p>Apr 2017 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The committee discussed this and solicited further input from the author for a
possible suggested technical corrigendum. Such was provided in <a href="https://www.open-std.org/jtc1/sc22/wg14/14657">(14657) DR 497
PTC</a>. From that document the
following sections were found appropriate and have been adopted.</p>
</blockquote>
<h3>Proposed Change</h3>
<p>In 7.1.1, add a new paragraph:</p>
<blockquote>
<p>In this clause, references to "white-space character" refer to (execution)
white-space character as defined by <strong>isspace()</strong>. References to "white-space
wide character" refer to (execution) white-space wide character as defined by
<strong>iswspace()</strong>.</p>
</blockquote>
<p>Remove '(as specified by the <strong>isspace</strong> function)' in: 7.21.6.2#8 (fscanf),
7.22.1.3#2 (strtod), 7.22.1.4#2 (strtol).</p>
<p>Remove '(as specified by the <strong>iswspace</strong> function)' in: 7.29.2.2#8 (fwscanf),
7.29.4.1.1#2 (wcstod), 7.29.4.1.2#2 (wcstol).</p>
<p>Change "white space" to "white-space characters": 7.21.6.2#15 (fscanf),
7.22.1.4#4 (strtol).</p>
<p>Change "white space" to "white-space wide characters": 7.29.2.2#15 (fwscanf),
7.29.4.1.2#4 (wcstol).</p>
<p>Add "white-space wide character" to the index.</p>

</body>
</html>
