<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0483: __LINE__ and __FILE__ in macro replacement list</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0483: <code>__LINE__</code> and <code>__FILE__</code> in macro replacement list</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: WG14, Fred J. Tydeman<br />
Date: 2015-06-23<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1943.htm">N1943</a><br />
Submitted against: C11 / C17<br />
Status: Closed<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2396.htm">n2396.htm</a></p>
<h3>Summary</h3>
<p>Based upon my reading of the standard, it appears that the following are
ambiguous, so are a possible defect.</p>
<ul>
<li>The line number associated with a __LINE__ in a macro replacment list. It could be the line number of the macro replacment list or of the macro invocation.</li>
<li>The source file name associated with a __FILE__ in a macro replacment list. It could be the file name of the macro replacment list or of the macro invocation.</li>
</ul>
<p>An example of that.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #bbbbbb">  </span><span style="color: #9C6500">#line 500</span>
<span style="color: #bbbbbb">  </span><span style="color: #9C6500">#define MAC() __LINE__</span>

<span style="color: #bbbbbb">  </span><span style="color: #9C6500">#line 1000</span>
<span style="color: #bbbbbb"> </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>j<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>MAC();<span style="color: #bbbbbb">         </span><span style="color: #3D7B7B; font-style: italic">/* is this 500 or 1000? */</span>
</pre></div>

<p>However, 7.2.1.1 requires that the <strong>assert</strong> macro write information about the
call that has a false expression. That information includes the __LINE__ and
__FILE__ preprocessing macros. So, there is a requirement that this specific
macro using __LINE__ and __FILE__ have the line number and file name of
the invocation, not the line number and file name of the replacment list (in
&lt;assert.h&gt;).</p>
<h3>Suggested Technical Corrigendum</h3>
<p>Add to 6.10.8.1, paragraph 1, item __LINE__:</p>
<blockquote>
<p>The line number associated with a __LINE__ in a macro replacment list is the
line number of the macro invocation.</p>
</blockquote>
<p>Add to 6.10.8.1, paragraph 1, item __FILE__:</p>
<blockquote>
<p>The source file name associated with a __FILE__ in a macro replacment list
is the source file name of the macro invocation.</p>
</blockquote>
<hr />
<p>Comment from WG14 on 2016-10-21:</p>
<p>Oct 2015 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The committee notes that these issues are also raised in the WG21 C++
committee document
<a href="https://www.open-std.org/jtc1/sc22/wg21/www/docs/papers/2014/n4220.pdf">N4220</a>.
However, the committee also notes that among all implementations “nobody gets
this wrong” and as such there is no actual confusion, and although there is
sentiment that the standard might not perfectly express its intent, it is clear
enough to warrant no change.</p>
</blockquote>
<h3>Proposed Committee Response</h3>
<blockquote>
<p>The committee believes that since there is no evidence of confusion over the
intent of the standard in this area by any implementor that there is no defect
worth correcting at this time.</p>
</blockquote>

</body>
</html>
