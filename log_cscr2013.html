<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C Secure Coding Rules TS 17961:2013: issue log</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h1>C Secure Coding Rules TS 17961:2013: issue log</h1>
<p><strong>This issue log has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<table>
<thead>
<tr>
<th align="left">Issue</th>
<th align="left">Summary</th>
<th align="left">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="log_cscr2013.html#issue0SCR.01">0SCR.01</a></td>
<td align="left">error in 5.21 example</td>
<td align="left">Fixed in C Secure Coding Rules TS 17961:2013 TC1</td>
</tr>
<tr>
<td align="left"><a href="log_cscr2013.html#issue0SCR.02">0SCR.02</a></td>
<td align="left">Missing formatted input/output functions in Rule 5.40</td>
<td align="left">Fixed in C Secure Coding Rules TS 17961:202y</td>
</tr>
</tbody>
</table>
<hr />
<div id="issue0SCR.01">
<h2>Issue 0SCR.01: error in 5.21 example</h2>
<p>Authors: WG14, Clive Pygott<br />
Date: 2014-03-11<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1801.htm">N1801</a><br />
Status: Fixed<br />
Fixed in: C Secure Coding Rules TS 17961:2013 TC1<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2150.htm">n2150.htm</a></p>
<h3>Summary</h3>
<p>The (cut-down) requirement for rule 5.21 is:</p>
<p><em>A call to a standard memory allocation function is presumed to be intended for
type T * when it appears in any of the following contexts</em></p>
<ul>
<li><em>in the right operand of an assignment to an object of type T *, or</em></li>
<li><em>...</em></li>
</ul>
<p><em>A call to a standard memory allocation function taking a size integer argument
n and presumed to be intended for type T * shall be diagnosed when n &lt;
sizeof(T).</em></p>
<p>{malloc is identified as a standard memory allocation function}</p>
<p>The example for 5.21 is:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span><span style="color: #0000FF">f1</span>(<span style="color: #B00040">void</span>)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>p<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">L&quot;Hello, World!&quot;</span>;
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">size_t</span><span style="color: #bbbbbb"> </span>n<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">sizeof</span>(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">*</span><span style="color: #bbbbbb"> </span>(wcslen(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">+</span><span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>);
<span style="color: #bbbbbb">    </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>)malloc(n);<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">// diagnostic required</span>
<span style="color: #bbbbbb">    </span><span style="color: #3D7B7B; font-style: italic">/* ... */</span>
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>q;
}
</pre></div>

<p>Why is a diagnostic required on the malloc statement? On my machine</p>
<ul>
<li>T is wchar_t</li>
<li>sizeof(p) == 4</li>
<li>wcslen(p) == 13</li>
<li>n == 56</li>
<li>sizeof(wchar_t) == 2</li>
</ul>
<p>56 is not less than 2, so no diagnostic is required.</p>
<p>Indeed, the only values of n that would require a diagnostic are 0 and 1.</p>
<p>I think the original intent was to make q smaller than 28 (the space required
for 14 wide characters), then copy p to q (buffer overrun), but this rule
doesn’t actually address that and the copy isn’t included in the example. That
is, I think the original example was to be of the form:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span><span style="color: #0000FF">f2</span>(<span style="color: #B00040">void</span>)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>p<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">L&quot;Hello, World!&quot;</span>;
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">size_t</span><span style="color: #bbbbbb"> </span>n<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb">  </span><span style="color: #3D7B7B; font-style: italic">/*sizeof(p) * */</span><span style="color: #bbbbbb"> </span>(wcslen(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">+</span><span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>);<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">/* NB  n == 14  */</span>
<span style="color: #bbbbbb">    </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>)malloc(n);
<span style="color: #bbbbbb">    </span>wcscpy(q,<span style="color: #bbbbbb"> </span>p);
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>q;
<span style="color: #bbbbbb">   </span>}
</pre></div>

<p>This does have an issue - buffer overrun, but still doesn’t violate 5.21 as
currently stated (14 is still &gt;= 2). I think the reason 5.21 got changed was
either:</p>
<ul>
<li>buffer overrun is addressed elsewhere - though I cannot see where that is:
<ul>
<li>Annex C maps CWEs with Buffer Overrun to 5.22 – but that only talks about constructing an invalid pointer by pointer arithmetic or indexing – neither of which apply here</li>
<li>wcscpy may be regarded as a restricted sink, with a requirement that the size of the first parameter array &gt;= the size of the second, so 5.46 could apply – except that 5.46 only applies to tainted data. The data in this example isn’t tainted</li>
</ul>
</li>
<li>It was recognised that it’s too difficult to carry the information around that lets you check what use is made of a buffer at an arbitrary point later in the program. The problem in the f2 example is on the line after the allocation, but in general it could be anywhere in the program</li>
</ul>
<h3>Suggested Technical Corrigendum</h3>
<p>Either 5.21 needs a different example, such as :</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span>{<span style="color: #bbbbbb"> </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>x,<span style="color: #bbbbbb"> </span>y,<span style="color: #bbbbbb"> </span>z;};<span style="color: #bbbbbb">   </span><span style="color: #3D7B7B; font-style: italic">/*  sizeof(S1)  is 12  */</span>

<span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>copyS1(<span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span>s)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>)malloc(<span style="color: #666666">8</span>);<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">/*  Diagnostic required */</span>
<span style="color: #bbbbbb">    </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>s;
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>q;
<span style="color: #bbbbbb">   </span>}
</pre></div>

<p>or the rule needs to be changed to reflect that the allocated memory is in
effect an array of size n/sizeof(T), and that it shouldn’t be indexed beyond
that size (including by copy functions such as wcscpy etc. - this caveat may
also need to be added to 5.22)</p>
<p>I'd favour changing the example</p>
<hr />
<p>Comment from WG14 on 2016-10-21:</p>
<p>Apr 2014 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The words in 5.21 were revised but the example wasn't. A revised example was
approved as a Proposed Technical Corregendum. A new paper was solicited to
capture the issue raised by the changed example.</p>
</blockquote>
<p>Oct 1014 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>A new paper <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1860.htm">N1860</a>
proposing a new rule was submitted and discussed, and it was determined that
since the original example illustrated an issue, that we could consider this a
defect after all.</p>
<p>The following Proposed Technical Corrigendum corrects the existing example to
match the 5.21 rule, and adds a new clause and example to capture the intent of
the original 5.21 example.</p>
<p>The existing example has an explanation, and the words approved do not, and the
following have been suggested.</p>
<blockquote>
<p>EXAMPLE 1 In this noncompliant example, a diagnostic is required because <code>n</code> is
<code>sizeof(p)</code>, which is smaller than <code>sizeof(struct S1)</code>, so N is 0</p>
<p>EXAMPLE 2 In this noncompliant example, a diagnostic is required because <code>n</code> is
14 and <code>sizeof(wchar_t)</code> is 2, making N equal 7. <code>q</code> is therefore treated as an
array of 7 elements, but <code>wcscpy</code> attempts to copy <code>p</code>, an array with 14
elements, into it.</p>
</blockquote>
</blockquote>
<h3>Proposed Technical Corrigendum</h3>
<p>In rule 5.21, Rule section, replace</p>
<blockquote>
<p>A call to a standard memory allocation function taking a size integer argument
<code>n</code> and presumed to be intended for type <code>T *</code> shall be diagnosed when <code>n &lt; sizeof(T)</code>.</p>
</blockquote>
<p>with</p>
<blockquote>
<p>A call to a standard memory allocation function taking a size integer argument
<code>n</code> and presumed to be intended for type <code>T *</code> shall be regarded as an array of
<code>N</code> elements, where <code>N = n / sizeof(T)</code>.</p>
<p>Any allocation where <code>N == 0</code> shall be diagnosed (i.e. where <code>n &lt; sizeof(T)</code>).
Also, any attempt to use this array in a manner that causes its array bound to
be violated shall be diagnosed.</p>
</blockquote>
<p>In rule 5.21, replace</p>
<blockquote>
<p>EXAMPLE In this noncompliant example, a diagnostic is required because the value
of <code>n</code> that is used in the <code>malloc()</code> call has been possibly miscalculated.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span><span style="color: #0000FF">f1</span>(<span style="color: #B00040">void</span>)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>p<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">L&quot;Hello, World!&quot;</span>;
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">size_t</span><span style="color: #bbbbbb"> </span>n<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">sizeof</span>(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">*</span><span style="color: #bbbbbb"> </span>(wcslen(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">+</span><span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>);
<span style="color: #bbbbbb">  </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>)malloc(n);<span style="color: #bbbbbb">  </span><span style="color: #3D7B7B; font-style: italic">// diagnostic required</span>

<span style="color: #bbbbbb">  </span><span style="color: #3D7B7B; font-style: italic">/* ... */</span>
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>q;
}
</pre></div>

</blockquote>
<p>with</p>
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span>EXAMPLE<span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>

<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">        </span><span style="color: #B00040">unsigned</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>x;
<span style="color: #bbbbbb">        </span><span style="color: #B00040">float</span><span style="color: #bbbbbb">        </span>y;
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb">   </span><span style="color: #666666">*</span>z;
<span style="color: #bbbbbb">    </span>};


<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>f1(<span style="color: #B00040">void</span>)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>p<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">S1</span><span style="color: #666666">*</span>)malloc(<span style="color: #008000; font-weight: bold">sizeof</span>(p));<span style="color: #bbbbbb">  </span><span style="color: #3D7B7B; font-style: italic">// diagnostic required</span>
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>p;
<span style="color: #bbbbbb">    </span>}





EXAMPLE<span style="color: #bbbbbb"> </span><span style="color: #666666">2</span>

<span style="color: #bbbbbb">    </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>f2(<span style="color: #B00040">void</span>)<span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>p<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">L&quot;Hello, World!&quot;</span>;
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">const</span><span style="color: #bbbbbb"> </span><span style="color: #B00040">size_t</span><span style="color: #bbbbbb"> </span>n<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(wcslen(p)<span style="color: #bbbbbb"> </span><span style="color: #666666">+</span><span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>);
<span style="color: #bbbbbb">        </span><span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>q<span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span>(<span style="color: #B00040">wchar_t</span><span style="color: #bbbbbb"> </span><span style="color: #666666">*</span>)malloc(n);
<span style="color: #bbbbbb">        </span>wcscpy(q,<span style="color: #bbbbbb"> </span>p);<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">// diagnostic required</span>
<span style="color: #bbbbbb">        </span><span style="color: #008000; font-weight: bold">return</span><span style="color: #bbbbbb"> </span>q;
<span style="color: #bbbbbb">    </span>}
</pre></div>

</blockquote>
</div>
<hr />
<hr />
<div id="issue0SCR.02">
<h2>Issue 0SCR.02: Missing formatted input/output functions in Rule 5.40</h2>
<p>Authors: WG14, Clive Pygott<br />
Date: 2016-03-01<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2006.htm">N2006</a><br />
Status: Fixed<br />
Fixed in: C Secure Coding Rules TS 17961:202y<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2150.htm">n2150.htm</a></p>
<h3>Summary</h3>
<p>This suggestion comes from MISRA, as they are adding support for 17961 to their
rules.</p>
<p>Rule 5.40 names a number of functions that can attempt to write beyond the
bounds of the target array, if supplied with tainted input, namely: fscanf,
scanf, vfscanf, vscanf, sscanf, vsscanf and sprintf.</p>
<p>The observation is that vsprintf should be included in this list. Also the _s
versions of all the above (including vsprintf_s) should be included, as they
also can write beyond the end of the target array.</p>
<p>It is suggested that this is a defect rather than an enhancement, as from the
rationale for the rule, they should have been included when drafted.</p>
<hr />
<p>Comment from WG14 on 2017-04-07:</p>
<p>Apr 2016 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The committee agrees with the author.</p>
</blockquote>
<h3>Proposed Technical Corrigendum</h3>
<p>To 5.40 Rule section first sentence change:</p>
<blockquote>
<p>Calls to the <code>fscanf</code>, <code>scanf</code>, <code>vfscanf</code>, and <code>vsscanf</code> functions that pass...</p>
</blockquote>
<p>to</p>
<blockquote>
<p>Calls to the <code>fscanf</code>, <code>scanf</code>, <code>vfscanf</code>, and <code>vsscanf</code> functions, and their
Annex K counterparts <code>fscanf_s</code>, <code>scanf_s</code>, <code>vfscanf_s</code>, and <code>vsscanf_s</code>, that
pass...</p>
</blockquote>
<p>To 5.40 Rule section second sentence change:</p>
<blockquote>
<p>Calls to the <code>sscanf</code> and <code>vsscanf</code> functions</p>
</blockquote>
<p>to</p>
<blockquote>
<p>Calls to the <code>sscanf</code>, <code>vsscanf</code>, <code>sscanf_s</code>, and <code>vsscanf_s</code> functions</p>
</blockquote>
<p>To 5.40 Rule section third sentence change:</p>
<blockquote>
<p>Calls to the <code>sprintf</code> function that</p>
</blockquote>
<p>to</p>
<blockquote>
<p>Calls to the <code>sprintf</code>, <code>vsprintf</code>, <code>sprintf_s</code>, and <code>vsprintf_s</code> functions that</p>
</blockquote>
</div>
<hr />

</body>
</html>
