<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0017.23: How long does blue paint persist on macro names?</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0017.23: How long does <code>blue paint</code> persist on macro names?</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: Derek M. Jones, WG14<br />
Date: 1992-12-10<br />
Reference document: X3J11/90-056<br />
Submitted against: C90<br />
Status: Closed<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr.htm">dr.htm</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_017.html">dr_017.html</a></p>
<p>How long does blue paint persist?</p>
<p>Consider the following code:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #9C6500">#define a(x) b</span>
<span style="color: #bbbbbb"> </span><span style="color: #9C6500">#define b(x) x</span>
<span style="color: #bbbbbb"> </span>a(a)(a)(a)
</pre></div>

<p>The macro replacement for <code>a(a)</code> results in <code>b</code>.</p>
<p>First replacement buffer: <code>b</code></p>
<p>Remaining tokens: <code>(a)(a)</code></p>
<p>Inside the first replacement buffer, no further nested replacements will
recognize the macro name “<code>a</code>.” The name “<code>a</code>” is painted blue.</p>
<p>The first replacement buffer is rescanned not by itself, but along with the rest
of the source program's tokens. “<code>b(a)</code>” also causes macro replacement and
becomes “<code>a</code>.”</p>
<p>Second replacement buffer: <code>a</code></p>
<p>Remaining tokens: <code>(a)</code></p>
<p>The second replacement buffer is rescanned not by itself, but along with the
rest of the source program's tokens.</p>
<p>The “<code>a</code>” in the second replacement buffer did not come from the first
replacement buffer. It came from three of the remaining tokens which were in the
source file following the first replacement buffer. Is this “<code>a</code>” part of a
nested replacement? Is it still painted blue?</p>
<p>Note that there are many “paths” that can be taken for a possible macro name to
travel from a preprocessing token (outside the replacement buffer) to one that
is inside the replacement buffer. When do they stop getting painted blue? If
either too early or too late, they cause very surprising results.</p>
<p>Given the amount of discussion involving macro expansion that uses the concept
of “blue paint,” why doesn't the standard tell the reader about this idea?</p>
<p>Everybody seems to agree that the above is undefined. Does anybody have a set of
words to make this and other cases explicitly undefined?</p>
<hr />
<p>Comment from WG14 on 1997-09-23:</p>
<h3>Response</h3>
<p>The reference is to subclause 6.8.3.4, page 91.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #9C6500">#define a(x) b</span>
<span style="color: #bbbbbb"> </span><span style="color: #9C6500">#define b(x) x</span>
<span style="color: #bbbbbb"> </span>a(a)(a)(a)<span style="color: #bbbbbb">      </span><span style="color: #3D7B7B; font-style: italic">/*  may expand as follows: */</span>
<span style="color: #bbbbbb"> </span>b(a)(a)
<span style="color: #bbbbbb"> </span>a<span style="border: 1px solid #FF0000">&#39;</span>(a)<span style="color: #bbbbbb">   </span>or<span style="color: #bbbbbb">       </span>a(a)
<span style="color: #bbbbbb"> </span>a(a)<span style="color: #bbbbbb">            </span>or<span style="color: #bbbbbb">       </span>b
<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">/* a&#39; indicates the symbol a marked for non-replacement */</span>
</pre></div>

<p>The Committee addressed this issue explicitly in previous deliberations and
decided to say nothing about the situation, understanding that behavior in such
cases would be undefined.</p>
<p>The result, as with other examples, is intentionally left undefined.</p>

</body>
</html>
