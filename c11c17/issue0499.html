<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0499: Anonymous structure in union behavior</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0499: Anonymous structure in union behavior</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: WG14, Rajan Bhakta<br />
Date: 2016-04-12<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2038.htm">N2038</a><br />
Submitted against: C11 / C17<br />
Status: Fixed<br />
Fixed in: C23<br />
Cross-references: <a href="../c11c17/issue0502.html">0502</a><br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2396.htm">n2396.htm</a></p>
<h3>Summary</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span>Given<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>following<span style="color: #bbbbbb"> </span>code<span style="color: #666666">:</span>

<span style="color: #008000; font-weight: bold">union</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">U</span><span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">  </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span>{
<span style="color: #bbbbbb">    </span><span style="color: #B00040">char</span><span style="color: #bbbbbb"> </span>B1;
<span style="color: #bbbbbb">    </span><span style="color: #B00040">char</span><span style="color: #bbbbbb"> </span>B2;
<span style="color: #bbbbbb">    </span><span style="color: #B00040">char</span><span style="color: #bbbbbb"> </span>B3;
<span style="color: #bbbbbb">    </span><span style="color: #B00040">char</span><span style="color: #bbbbbb"> </span>B4;
<span style="color: #bbbbbb">  </span>};
<span style="color: #bbbbbb">  </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>word;
}<span style="color: #bbbbbb"> </span>u;

Does<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>storage<span style="color: #bbbbbb"> </span>of<span style="color: #bbbbbb"> </span>B1,<span style="color: #bbbbbb"> </span>B2,<span style="color: #bbbbbb"> </span>B3<span style="color: #bbbbbb"> </span>and<span style="color: #bbbbbb"> </span>B4<span style="color: #bbbbbb"> </span>overlap<span style="color: #666666">?</span>

According<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span><span style="color: #666666">6.7.2.1</span><span style="border: 1px solid #FF0000">#</span><span style="color: #666666">13</span>,<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span>should<span style="color: #bbbbbb"> </span>overlap<span style="color: #bbbbbb"> </span>in<span style="color: #bbbbbb"> </span>storage<span style="color: #bbbbbb"> </span>as<span style="color: #bbbbbb"> </span>they<span style="color: #bbbbbb"> </span>become<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span>of<span style="color: #bbbbbb"> </span><span style="border: 1px solid #FF0000">&#39;</span><span style="color: #008000; font-weight: bold">union</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">U</span><span style="border: 1px solid #FF0000">&#39;</span>.
At<span style="color: #bbbbbb"> </span>least<span style="color: #bbbbbb"> </span>one<span style="color: #bbbbbb"> </span>implementation<span style="color: #bbbbbb"> </span>(GCC)<span style="color: #bbbbbb"> </span>seems<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span>NOT<span style="color: #bbbbbb"> </span>consider<span style="color: #bbbbbb"> </span>them<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span>be<span style="color: #bbbbbb"> </span>overlapping.
At<span style="color: #bbbbbb"> </span>least<span style="color: #bbbbbb"> </span>one<span style="color: #bbbbbb"> </span>implementation<span style="color: #bbbbbb"> </span>(IBM<span style="border: 1px solid #FF0000">&#39;</span>s<span style="color: #bbbbbb"> </span>XL<span style="color: #bbbbbb"> </span>LE<span style="color: #bbbbbb"> </span>AIX)<span style="color: #bbbbbb"> </span>considers<span style="color: #bbbbbb"> </span>them<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span>be<span style="color: #bbbbbb"> </span>overlapping<span style="color: #bbbbbb"> </span>as<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>standard<span style="color: #bbbbbb"> </span>currently<span style="color: #bbbbbb"> </span>states.

Similar<span style="color: #bbbbbb"> </span>code<span style="color: #bbbbbb"> </span>present<span style="color: #bbbbbb"> </span>in<span style="color: #bbbbbb"> </span>example<span style="color: #bbbbbb"> </span><span style="color: #666666">1</span><span style="color: #bbbbbb"> </span>on<span style="color: #bbbbbb"> </span><span style="color: #666666">6.7.2.1</span><span style="border: 1px solid #FF0000">#</span><span style="color: #666666">19.</span>

Suggested<span style="color: #bbbbbb"> </span>TC<span style="color: #666666">:</span>
<span style="color: #bbbbbb">  </span>If<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>intent<span style="color: #bbbbbb"> </span>is<span style="color: #bbbbbb"> </span>that<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">do</span><span style="color: #bbbbbb"> </span>NOT<span style="color: #bbbbbb"> </span>overlap<span style="color: #666666">:</span>
<span style="color: #bbbbbb">    </span>Append<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span><span style="color: #666666">6.7.2.1</span><span style="border: 1px solid #FF0000">#</span><span style="color: #666666">13:</span>
<span style="color: #bbbbbb">      </span>Anonymous<span style="color: #bbbbbb"> </span>structures<span style="color: #bbbbbb"> </span>maintain<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>structure<span style="color: #bbbbbb"> </span>type<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">if</span><span style="color: #bbbbbb"> </span>they<span style="color: #bbbbbb"> </span>are<span style="color: #bbbbbb"> </span>considered<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span>be<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span>of<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>containing<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">union</span>.<span style="color: #666666">*</span>)
<span style="color: #bbbbbb">      </span><span style="color: #666666">*</span>)<span style="color: #bbbbbb"> </span>This<span style="color: #bbbbbb"> </span>means<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>structure<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span>are<span style="color: #bbbbbb"> </span>not<span style="color: #bbbbbb"> </span>considered<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span>occupy<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>same<span style="color: #bbbbbb"> </span>storage<span style="color: #bbbbbb"> </span>as<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">if</span><span style="color: #bbbbbb"> </span>they<span style="color: #bbbbbb"> </span>were<span style="color: #bbbbbb"> </span>directly<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">union</span><span style="color: #bbbbbb"> </span><span style="color: #0000FF; font-weight: bold">members</span>.
<span style="color: #bbbbbb">  </span>If<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>intent<span style="color: #bbbbbb"> </span>is<span style="color: #bbbbbb"> </span>that<span style="color: #bbbbbb"> </span>the<span style="color: #bbbbbb"> </span>members<span style="color: #bbbbbb"> </span>DO<span style="color: #bbbbbb"> </span>overlap<span style="color: #666666">:</span>
<span style="color: #bbbbbb">    </span>No<span style="color: #bbbbbb"> </span>change,<span style="color: #bbbbbb"> </span>or<span style="color: #bbbbbb"> </span>perhaps<span style="color: #bbbbbb"> </span>add<span style="color: #bbbbbb"> </span>on<span style="color: #bbbbbb"> </span>a<span style="color: #bbbbbb"> </span>comment<span style="color: #bbbbbb"> </span>to<span style="color: #bbbbbb"> </span><span style="color: #666666">6.7.2.1</span><span style="border: 1px solid #FF0000">#</span><span style="color: #666666">19</span><span style="color: #bbbbbb"> </span>Example<span style="color: #bbbbbb"> </span><span style="color: #666666">1:</span>
<span style="color: #bbbbbb">    </span>...
<span style="color: #bbbbbb">    </span><span style="color: #008000; font-weight: bold">struct</span><span style="color: #bbbbbb"> </span>{<span style="color: #bbbbbb"> </span><span style="color: #B00040">int</span><span style="color: #bbbbbb"> </span>i,<span style="color: #bbbbbb"> </span>j;<span style="color: #bbbbbb"> </span>};<span style="color: #bbbbbb"> </span><span style="color: #3D7B7B; font-style: italic">// anonymous structure, i and j now overlap in storage</span>
<span style="color: #bbbbbb">    </span>...
</pre></div>

<hr />
<p>Comment from WG14 on 2018-10-18:</p>
<p>Oct 2016 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The storage does not overlap.</p>
<p>A related issue is to be found in <a href="../c11c17/issue0502.html">DR 502</a> and both may be resolved
with coordinated wording changes.</p>
</blockquote>
<p>Apr 2017 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The committee briefly discussed <a href="https://www.open-std.org/jtc1/sc22/wg14/14628">(SC22WG14.14628) My approach to DR 499 and
502</a> which argues that this might
be simply an editorial issue, such that a change as simple as:</p>
<p>Change §6.7.2.1 p13 from:</p>
<blockquote>
<p>An unnamed member of structure type with no tag is called an <em>anonymous
structure</em>; an unnamed member of union type with no tag is called an <em>anonymous
union</em>. The members of an anonymous structure or union are considered to be
members of the containing structure or union. This applies recursively if the
containing structure or union is also anonymous.</p>
</blockquote>
<p>to:</p>
<blockquote>
<p>An unnamed member of structure type with no tag is called an <em>anonymous
structure</em>; an unnamed member of union type with no tag is called an <em>anonymous
union</em>. The names of members of an anonymous structure or union are added to the
name space of the containing structure or union. This applies recursively if the
containing structure or union is also anonymous.</p>
</blockquote>
<p>would adequately resolve the issue.</p>
</blockquote>
<p>Oct 2017 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The suggestion almost works but not quite, as discussed in <a href="https://www.open-std.org/jtc1/sc22/wg14/14632">(SC22WG14.14632) My
approach to DR 499 and 502,</a>
where a flexible array member following an anonymous structure would no longer
be allowed.</p>
<p>Further thought is needed.</p>
</blockquote>
<p>Apr 2018 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>A short paper was solicited, discussed, and adopted as the Proposed Change to a
new revision of the Standard.</p>
<p>It was noted that additional wording might be appropriate with regard to both
tail padding and to address flexible array members.</p>
</blockquote>
<h3>Proposed Change</h3>
<p>Change §6.7.2.1 p13 from:</p>
<blockquote>
<p>An unnamed member of structure type with no tag is called an <em>anonymous
structure</em>; an unnamed member of union type with no tag is called an <em>anonymous
union</em>. The members of an anonymous structure or union are considered to be
members of the containing structure or union. This applies recursively if the
containing structure or union is also anonymous.</p>
</blockquote>
<p>to:</p>
<blockquote>
<p>An unnamed member of structure type with no tag is called an <em>anonymous
structure</em>; an unnamed member of union type with no tag is called an <em>anonymous
union</em>. The members of an anonymous structure or union are considered to be
members of the containing structure or union, keeping their structure or union
layout. This applies recursively if the containing structure or union is also
anonymous.</p>
</blockquote>

</body>
</html>
