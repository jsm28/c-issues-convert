<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>C issue 0441: Floating-point issues in C11 from PDTS 18661-1 UK review, Issue 2</title>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<h2>Issue 0441: Floating-point issues in C11 from PDTS 18661-1 UK review, Issue 2</h2>
<p><strong>This issue has been automatically converted from the original issue lists and some formatting may not have been preserved.</strong></p>
<p>Authors: WG 14, Joseph Myers<br />
Date: 2013-07-21<br />
Reference document: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1730.pdf">N1730</a><br />
Submitted against: C11 / C17<br />
Status: Fixed<br />
Fixed in: C17<br />
Converted from: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2396.htm">n2396.htm</a></p>
<h3>Summary</h3>
<p>Some issues with floating point in C11 have been identified as part of the UK
review of the N1711 draft of TS 18661-1. While such issues relate to the general
area of C bindings to IEC 60559:2011, and so could be addressed in the TS on
that basis, since the issues also apply to C11 as-is it may be more appropriate
to address some or all of these issues as Defect Reports with a view to having a
normative fix in a future TC to C11 rather than only having a fix in conjunction
with the new bindings.</p>
<p>Issue 2: Definition of FLT_ROUNDS</p>
<p>The C11 definition of FLT_ROUNDS is inadequate in that it refers to
floating-point addition but does not say addition of what type. If long double
is not an IEC 60559 type, it may not fully support all rounding modes even
though they are supported by other types. (This is an actual issue with real
implementations using non-IEC 60559 types for long double.) A suitable fix would
be:</p>
<blockquote>
<p>In 5.2.4.2.2#8, insert "for type float" after "floating-point addition". At the
end of F.2#1, insert "The value of FLT_ROUNDS applies to all IEC 60559 types
supported by the implementation, but may not apply to non-IEC 60559 types.".</p>
</blockquote>
<hr />
<p>Comment from WG14 on 2017-11-03:</p>
<p>Oct 2013 meeting</p>
<blockquote>
<p>The committee adopted a Proposed Committee Response that has been substantially
revised.</p>
</blockquote>
<p>Oct 2014 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The Proposed Committee Response was revised for accuracy and more detailed
information, and is provided below.</p>
</blockquote>
<p><strong>Proposed Committee Response (obsolete)</strong></p>
<blockquote>
<p>The committee regards the existing definition of <code>FLT_ROUNDS</code> as intended to
apply to types <code>float</code>, <code>double</code> and <code>long double</code>. However, if all three types
cannot support the same set of rounding modes, the implementation needs to set
<code>FLT_ROUNDS</code> to -1 meaning indeterminable.</p>
<p>As has been pointed out, in Annex F, only the types float and double need be IEC
60559 types. If long double is not an IEC 60559 type (for example, a pair of
doubles), it may not support the same set of rounding modes as float and double.
In this case, having <code>FLT_ROUNDS</code> apply to float and double (but not long
double) would result in a value of 0, 1, 2, or 3 and would provide new and
useful information to the programmer.</p>
<p>However, this behavioral change could also break existing programs, and as such
the committee prefers to leave as is for this revision of the Standard.</p>
</blockquote>
<p>Apr 2015 meeting</p>
<h3>Committee Discussion</h3>
<blockquote>
<p>The Proposed Committee Response was revised yet again based on the input that
since FLT_ROUNDS in existing practice is universally coded as 1, the proposed
changes wonâ€™t affect existing practice.</p>
</blockquote>
<h3>Proposed Committee Response</h3>
<blockquote>
<p>The implementation of <code>long double</code>, for example, may significantly differ from
IEC floating types and may not support the same choices as would otherwise be
possible for <code>FLT_ROUNDS</code>. All known implementations define <code>FLT_ROUNDS</code> as the
value <code>1</code> (round to nearest). and as such exempting non-IEC <code>long double</code>
behavior allows the potential for implementations to provide the full range of
possible values for IEC floating types.</p>
</blockquote>
<h3>Proposed Technical Corrigendum</h3>
<p>At the end of F.2#1, insert</p>
<blockquote>
<p>The value of FLT_ROUNDS applies to all IEC 60559 types supported by the
implementation, but need not apply to non-IEC 60559 types.</p>
</blockquote>

</body>
</html>
